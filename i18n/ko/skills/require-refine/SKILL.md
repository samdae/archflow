---
name: Require Refine
description: 비정형 요구사항을 정제된 문서로 변환. Triggers on "요구사항", "require refine", "요구사항 정리", "기능 정의". architect 스킬의 입력 품질 보장.
version: 2.0.0
---

# Require Refine Workflow

비정형 자료를 분석하여 정제된 요구사항 문서를 생성합니다.

## 💡 권장 모델

**Opus** 권장 (품질 우선) / Sonnet 가능 (비용 절감 시)

→ 설계 품질에 영향을 주므로 가급적 고성능 모델 사용

## 🔄 도구 폴백 (Fallback)

| 도구 | 없을 때 대체 방법 |
|------|-----------------|
| **Read/Grep** | 사용자에게 파일 경로 목록 요청 → 필요한 부분 복사-붙여넣기 요청 |
| **AskQuestion** | "다음 중 선택해주세요: 1) 옵션A 2) 옵션B 3) 옵션C" 형태로 질문 |
| **Task** | 단계별 체크리스트로 대체, 각 단계 완료 후 다음 단계 안내 |

## 📁 문서 구조

```
projectRoot/
  └── docs/
        └── {serviceName}/
              ├── requirements.md   # ← 이 스킬의 출력
              ├── architect.md      # architect 스킬 출력
              └── changelog.md      # bugfix 스킬 출력
```

## ⚠️ Global Rule: 논리적 불일치 처리

사용자의 피드백이 Section 1(목적)이나 기존 분석 내용과 충돌할 경우:

### 1단계: 불일치 감지 및 보고

```markdown
⚠️ **논리적 불일치 감지**

**기존 내용**: {기존에 확정된 내용}
**사용자 피드백**: {충돌하는 새 내용}
**충돌 지점**: {어떤 부분이 충돌하는지}
```

### 2단계: 의사결정 선택지 제시

**AskQuestion으로 선택 요청:**

```json
{
  "title": "논리적 불일치 해결",
  "questions": [
    {
      "id": "resolution",
      "prompt": "기존 내용과 새 피드백이 충돌합니다. 어떻게 처리할까요?",
      "options": [
        {"id": "keep_original", "label": "기존 내용 유지 - 새 피드백 무시"},
        {"id": "accept_new", "label": "새 피드백 채택 - 기존 내용 수정"},
        {"id": "merge", "label": "병합 - 두 내용 모두 반영 (설명 입력)"},
        {"id": "clarify", "label": "추가 설명 필요 - 더 자세히 알려주세요"}
      ]
    }
  ]
}
```

**선택별 처리:**
- `keep_original` → 경고 로그 남기고 기존 유지
- `accept_new` → 기존 내용 수정, 변경 이유 기록
- `merge` → 사용자에게 병합 방법 추가 입력 요청
- `clarify` → 상세 설명 요청 후 재분석

## 지원 입력 형태

| 형태 | 권장 방식 | 비권장 |
|------|----------|--------|
| 노션/마크다운 | MD 파일로 전달 | - |
| 채팅 내역 | 텍스트로 복붙 또는 MD에 포함 | - |
| 이미지 | **별도 파일로 첨부** (@참조) | MD 내 embed ❌ |
| 혼합 | MD + 이미지 별도 첨부 | - |

⚠️ **이미지 주의**: MD 파일에 embed하면 분석 불가. 반드시 `@이미지경로` 형태로 별도 첨부.

## Phase 0: 스킬 진입

### 0-0. 모델 안내 (시작 시 출력)

> 💡 **이 스킬은 Opus 모델에서 최적의 결과를 보입니다.**
> 비용 절감이 필요하면 Sonnet도 가능하지만, 설계 품질에 영향을 줄 수 있습니다.
>
> **출력 위치**: `docs/{serviceName}/requirements.md`

### 0-1. 서비스명 및 입력 정보 수집

스킬만 호출 시 (입력 정보 없이) **AskQuestion으로 필요 정보 안내**:

```json
{
  "title": "요구사항 정리 시작",
  "questions": [
    {
      "id": "input_type",
      "prompt": "자료 형태를 선택해주세요",
      "options": [
        {"id": "md", "label": "마크다운/노션 (MD 파일)"},
        {"id": "chat", "label": "채팅 내역 (텍스트)"},
        {"id": "image", "label": "이미지 (피그마 등)"},
        {"id": "mixed", "label": "혼합 (MD + 이미지)"}
      ]
    },
    {
      "id": "has_file",
      "prompt": "파일이 준비되어 있나요?",
      "options": [
        {"id": "yes", "label": "예 - 파일 경로 알려드릴게요"},
        {"id": "no", "label": "아니오 - 직접 입력할게요"}
      ]
    },
    {
      "id": "domain",
      "prompt": "이 기능이 속한 도메인(업종/분야)은?",
      "options": [
        {"id": "ecommerce", "label": "이커머스/쇼핑몰"},
        {"id": "fintech", "label": "핀테크/금융"},
        {"id": "manufacturing", "label": "제조/생산관리"},
        {"id": "saas", "label": "SaaS/B2B"},
        {"id": "healthcare", "label": "헬스케어/의료"},
        {"id": "other", "label": "기타 (직접 입력)"}
      ]
    }
  ]
}
```

### 0-2. 서비스명 입력

AskQuestion 후 추가 질문:

> "서비스/기능 이름을 입력해주세요 (예: alert, auth, payment)"
> 이 이름으로 `docs/{serviceName}/` 폴더에 문서가 저장됩니다.

**serviceName 규칙:**
- 영문 소문자
- 공백 대신 하이픈(-) 또는 언더스코어(_)
- 예: `alert`, `user-auth`, `order_management`

사용자 응답 후 → 파일 경로 또는 직접 입력 요청 → Phase 1로 진행

## Phase 1: 입력 수집

사용자에게 다음 확인:
- 비정형 자료 경로 또는 내용
- 기능의 대략적인 목적 (한 줄)

**이미 파일이 제공된 경우** → 바로 Phase 2로 진행

## Phase 2: 초안 분석

입력 자료를 분석하여 초안 작성:

1. 자료 전체 읽기 (이미지는 비전 분석)
2. 핵심 기능 추출
3. 불분명한 부분 식별
4. 초안 구조에 맞춰 정리

## Phase 3: 질의 응답 루프

불분명한 사항을 **AskQuestion**으로 해소:

```
반복:
  1. 불분명한 사항 중 우선순위 높은 1-2개 질문
  2. 사용자 답변 수신
  3. 답변 반영하여 문서 업데이트
  4. 남은 불분명 사항 확인

종료 조건:
  - 모든 필수 항목 해소
  - 또는 사용자가 "이 정도면 충분" 선택
```

**질의 규칙:**
- 한 번에 1-2개 질문만 (사용자 피로도 관리)
- 선택지 제공 가능하면 제공 (자유 입력보다 선택이 빠름)
- 기술적 질문은 피하고 비즈니스 관점 질문 우선

## Phase 4: 사용자 검토

완성된 초안을 사용자에게 제시:

**AskQuestion으로 확인:**

```json
{
  "title": "요구사항 문서 검토",
  "questions": [
    {
      "id": "review_result",
      "prompt": "요구사항 문서를 검토해주세요. 어떻게 진행할까요?",
      "options": [
        {"id": "approve", "label": "승인 - 이대로 저장"},
        {"id": "modify", "label": "수정 필요 - 특정 부분 변경"},
        {"id": "add", "label": "항목 추가 - 빠진 내용 있음"},
        {"id": "restart", "label": "다시 작성 - 방향이 잘못됨"}
      ]
    }
  ]
}
```

**응답별 처리:**
- `approve` → Phase 5로 진행 (저장)
- `modify` / `add` → 수정 내용 입력 받고 Phase 3로 돌아가 반복
- `restart` → Phase 2로 돌아가 초안 재작성

## Phase 5: 최종 문서 저장

승인 시 MD 파일로 저장:
- **경로**: `docs/{serviceName}/requirements.md`
- 폴더가 없으면 생성

### 완료 후 안내

문서 저장 후 사용자에게 안내:

> ✅ **요구사항 문서 작성 완료**
>
> 저장 위치: `docs/{serviceName}/requirements.md`
>
> **다음 단계**: `architect` 스킬을 실행하여 설계를 시작하세요.
> → `@docs/{serviceName}/requirements.md` 파일을 전달하세요.

---

# 출력 문서 템플릿

```markdown
# 요구사항 정의서: {기능명}

> 생성일: {날짜}
> 서비스: {serviceName}
> 원본 자료: {입력 파일 경로}
> 도메인: {도메인}

## 0. 개발 대상

- [ ] Backend
- [ ] Frontend
- [ ] 둘 다

## 1. 비즈니스 컨텍스트

### 목적
(왜 이 기능이 필요한가)

### 사용자
(누가 쓰는가)

### 해결하려는 문제
(어떤 페인포인트를 해결하는가)

## 2. 기능 명세

### 2-1. BE 관점
- ...

### 2-2. FE 관점
- ...

## 3. 관련 기존 모듈

| 종류 | 이름 | 영향 |
|------|------|------|
| 테이블 | | |
| API | | |
| 서비스 | | |

## 4. 비기능 요구사항

| 항목 | 요구사항 |
|------|----------|
| 성능 | |
| 보안 | |
| 동시성 | |

## 4.5. 데이터 계약 (Data Contract)

### 입력 데이터
| 필드 | 타입 | 필수 | 유효성 검증 | 출처 |
|------|------|------|------------|------|
| | | | | |

### 출력 데이터
| 필드 | 타입 | 설명 | 소비자 |
|------|------|------|--------|
| | | | |

### 데이터 권한
| 데이터 | 읽기 | 쓰기 | 조건 |
|--------|------|------|------|
| | | | |

## 4.6. 예외 및 에러 정책

### 예상 예외 상황
| 상황 | 처리 방식 | 사용자 메시지 |
|------|----------|--------------|
| | | |

### 에러 응답 형식
| HTTP 코드 | 에러 코드 | 상황 |
|-----------|----------|------|
| | | |

### 복구 전략
- **재시도 가능**: (어떤 작업이 재시도 가능한지)
- **롤백 필요**: (어떤 상황에서 롤백이 필요한지)
- **알림 필요**: (어떤 에러 시 알림을 보내야 하는지)

## 5. 불분명한 사항

(질의로 해소되지 못한 항목)

- [ ] ...

## 6. 개발 우선순위

### MVP (필수)
1. ...

### Should Have
1. ...

### Nice to Have
1. ...

## 7. 완료 조건

- [ ] 조건1
- [ ] 조건2
```

---

# 연계

```
[require-refine] → docs/{serviceName}/requirements.md
        ↓
[architect] → docs/{serviceName}/architect.md
        ↓
[implement] → 구현
        ↓
(버그 발생)
        ↓
[bugfix] → docs/{serviceName}/changelog.md
```
