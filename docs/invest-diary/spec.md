# 요구사항 정의서: 투자일기

> 생성일: 2026-02-05
> 서비스: invest-diary
> 원본 자료: docs/invest-diary/proposal.md
> 도메인: Fintech/금융 투자

## 0. 요구사항 요약

| Req ID | 카테고리 | 요구사항 | 우선순위 | 상태 |
|--------|----------|----------|----------|------|
| FR-001 | 인증 | 소셜 로그인 (Google/Kakao) | High | Designed |
| FR-002 | 포트폴리오 | 보유 자산 수동 등록/수정/삭제 | High | Designed |
| FR-003 | 포트폴리오 | 국내/미국 주식 지원 | High | Designed |
| FR-004 | 매매기록 | 포트폴리오 변경을 통한 매수/매도 기록 | High | Designed |
| FR-005 | 투자일기 | 매매기록 + 판단 근거 작성 | High | Designed |
| FR-006 | 데이터 수집 | 시장 데이터 표시 (MVP: 90일 Mock 데이터) | High | Designed |
| FR-007 | 분석 | 고정일 자동 분석 알림 | High | Draft |
| FR-008 | 분석 | 사용자 요청 시점 분석 | High | Designed |
| FR-009 | 분석 | 분석 기간 사용자 설정 (7/14/30/90일) | Medium | Draft |
| FR-010 | 분석 | 복합 점수 산정 (수익률+방향성+타이밍) | High | Designed |
| FR-011 | 분석 | 사용자 자체 분석 작성 옵션 | Medium | Draft |
| FR-012 | 분석 | AI 분석 vs 자체 분석 비교 | Medium | Draft |
| FR-013 | 조회 | 분석 결과 날짜별 저장/재조회 | High | Designed |
| FR-014 | 포트폴리오 | 증권사 API 연동 | Low | Draft |

> **Req ID 규칙**: `FR-{number}` 형식. 신규 = max + 1. 삭제된 번호 재사용 금지.
> **상태**: `Draft` → `Designed` (arch 후) → `Implemented` (build 후)

## 0.5. 개발 대상

- [x] Backend
- [x] Frontend

## 1. 비즈니스 컨텍스트

### 목적
투자자가 자신의 매매 기록과 판단 근거를 체계적으로 기록하고, AI 분석을 통해 과거 판단의 정확도를 객관적으로 평가받아 투자 실력을 향상시키는 서비스

### 사용자
- 개인 투자자 (국내/미국 주식)
- 투자 일지를 작성하고 자기 성찰을 원하는 투자자
- 자신의 투자 판단력을 객관적으로 측정하고 싶은 투자자

### 해결하려는 문제
1. **기록 부재**: 매매 시점의 판단 근거를 기록하지 않아 복기 불가
2. **객관성 부재**: 자신의 투자 판단이 맞았는지 주관적으로만 평가
3. **컨텍스트 부재**: 매매 당시 시장 상황(지수, 뉴스, 지표)을 함께 기록하지 않음
4. **피드백 부재**: 시간이 지난 후 체계적인 분석/피드백 없음

## 2. 기능 명세

### 2-1. Backend 관점

#### 인증 (FR-001)
- OAuth 2.0 기반 소셜 로그인
- 지원 Provider: Google, Kakao
- JWT 기반 세션 관리

#### 포트폴리오 관리 (FR-002, FR-003)
- 보유 자산 CRUD
- 자산 정보: 종목코드, 종목명, 수량, 평균매입가, 매입일
- 지원 시장: 한국(KRX), 미국(NYSE, NASDAQ)
- 통화: KRW, USD

#### 매매기록 (FR-004)
- 포트폴리오 변경 시 자동 매매기록 생성
- 기록 내용: 종목, 매수/매도, 수량, 가격, 일시
- 포트폴리오 스냅샷 저장 (변경 전/후)

#### 투자일기 (FR-005)
- 매매기록과 연결된 투자일기 작성
- 필드: 제목, 본문(판단 근거), 태그, 첨부(선택)
- 날짜별 단일 일기 (하루에 하나)

#### 시장 데이터 (FR-006)

> ⚠️ **MVP 전략**: 실제 API 연동 대신 **90일치 Mock 데이터**로 PoC 진행
> 실제 API 연동은 PoC 검증 후 구현

##### 수집 항목 및 데이터 스펙

| # | 카테고리 | 항목 | 갱신주기 | 실제 API 출처 | 제공기간 |
|---|----------|------|----------|---------------|----------|
| 1 | 주가 | 한국 주식 일봉 (OHLCV) | 일 1회 | 공공데이터포털 / KOSCOM | 과거 수년 |
| 2 | 주가 | 미국 주식 일봉 (OHLCV) | 일 1회 | Yahoo Finance (yfinance) | 1970년~ |
| 3 | 지수 | KOSPI | 일 1회 | KRX / KOSCOM | 과거 수년 |
| 4 | 지수 | KOSDAQ | 일 1회 | KRX / KOSCOM | 과거 수년 |
| 5 | 지수 | S&P500 | 일 1회 | Yahoo Finance | 1970년~ |
| 6 | 지수 | NASDAQ | 일 1회 | Yahoo Finance | 1970년~ |
| 7 | 지수 | DOW | 일 1회 | Yahoo Finance | 1970년~ |
| 8 | 공포지수 | VIX | 일 1회 | CBOE / Yahoo Finance | 1993년~ |
| 9 | 원자재 | WTI 유가 | 일 1회 | OilPriceAPI / FRED | 20년+ |
| 10 | 원자재 | 금 가격 | 일 1회 | FreeGoldAPI / FRED | 수십년 |
| 11 | 금리 | 미국 기준금리 (Fed Funds) | 월 1회 | FRED API | 수십년 |
| 12 | 금리 | 한국 기준금리 | 월 1회 | 한국은행 ECOS | 수십년 |
| 13 | 금리 | 일본 기준금리 | 월 1회 | FRED API | 수십년 |
| 14 | 물가 | 미국 CPI | 월 1회 | FRED API | 수십년 |
| 15 | 물가 | 한국 CPI | 월 1회 | 한국은행 ECOS | 수십년 |
| 16 | 고용 | 미국 실업률 | 월 1회 | FRED API | 수십년 |
| 17 | 고용 | 미국 비농업 고용 | 월 1회 | FRED API | 수십년 |
| 18 | 뉴스 | 경제 뉴스 헤드라인 | 일 1회 | Finnhub / Financial News API | 5~10년 |

##### 항목별 데이터 포맷 (JSON Schema)

**1-2. 주가 데이터 (Stock OHLCV)**
```json
{
  "symbol": "005930",           // 종목코드 (삼성전자)
  "market": "KRX",              // KRX | NYSE | NASDAQ
  "date": "2026-02-05",
  "open": 71500,                // 시가
  "high": 72000,                // 고가
  "low": 71000,                 // 저가
  "close": 71800,               // 종가
  "volume": 12345678,           // 거래량
  "value": 885000000000,        // 거래대금 (원/USD)
  "currency": "KRW"             // KRW | USD
}
```

**3-7. 지수 데이터 (Index)**
```json
{
  "index": "KOSPI",             // KOSPI | KOSDAQ | SPX | IXIC | DJI
  "date": "2026-02-05",
  "open": 2650.12,
  "high": 2665.30,
  "low": 2645.00,
  "close": 2660.45,
  "volume": 450000000,          // 거래량 (해당 시)
  "change": 15.30,              // 전일 대비
  "changePercent": 0.58         // 전일 대비 %
}
```

**8. VIX 공포지수**
```json
{
  "index": "VIX",
  "date": "2026-02-05",
  "open": 18.50,
  "high": 19.20,
  "low": 17.80,
  "close": 18.90,
  "level": "normal"             // low (<15) | normal (15-25) | high (25-35) | extreme (>35)
}
```

**9-10. 원자재 가격**
```json
{
  "commodity": "WTI",           // WTI | BRENT | GOLD
  "date": "2026-02-05",
  "price": 74.52,
  "currency": "USD",
  "unit": "barrel",             // barrel | troy_oz
  "change": -0.85,
  "changePercent": -1.13
}
```

**11-13. 금리 데이터**
```json
{
  "indicator": "FED_FUNDS",     // FED_FUNDS | BOK_BASE | BOJ_RATE
  "country": "US",              // US | KR | JP
  "date": "2026-02-05",
  "rate": 5.25,                 // %
  "previousRate": 5.25,
  "nextMeetingDate": "2026-03-15",
  "outlook": "hold"             // hike | hold | cut | unknown
}
```

**14-15. 소비자물가지수 (CPI)**
```json
{
  "indicator": "CPI",
  "country": "US",              // US | KR
  "date": "2026-01-01",         // 월별 데이터
  "value": 314.5,               // 지수값
  "yoyChange": 3.2,             // 전년동월대비 %
  "momChange": 0.3              // 전월대비 %
}
```

**16-17. 고용지표**
```json
{
  "indicator": "UNEMPLOYMENT",  // UNEMPLOYMENT | NONFARM_PAYROLL
  "country": "US",
  "date": "2026-01-01",
  "value": 3.7,                 // 실업률 % 또는 고용수 (천명)
  "unit": "percent",            // percent | thousands
  "change": -0.1,
  "forecast": 3.8               // 예상치 (있는 경우)
}
```

**18. 뉴스 데이터**
```json
{
  "id": "news_20260205_001",
  "date": "2026-02-05",
  "publishedAt": "2026-02-05T09:30:00Z",
  "source": "Reuters",
  "category": "economy",        // economy | market | company | policy
  "headline": "Fed maintains rates amid inflation concerns",
  "summary": "The Federal Reserve...",
  "sentiment": 0.15,            // -1.0 (negative) ~ +1.0 (positive)
  "relatedSymbols": ["SPY", "QQQ"],
  "importance": "high"          // low | medium | high
}
```

##### MVP Mock 데이터 생성 가이드

**범위**: 2025-11-07 ~ 2026-02-05 (90일)

| 항목 | Mock 생성 방식 | 비고 |
|------|---------------|------|
| 주가 | 실제 과거 데이터 기반 + 랜덤 노이즈 | 주요 종목 10개 |
| 지수 | 실제 과거 데이터 복사 | Yahoo Finance에서 수집 |
| VIX | 실제 과거 데이터 복사 | Yahoo Finance ^VIX |
| 원자재 | 실제 과거 데이터 복사 | FRED CL=F, GC=F |
| 금리 | 실제 과거 데이터 복사 | FRED FEDFUNDS 등 |
| CPI | 실제 과거 데이터 복사 | FRED CPIAUCSL 등 |
| 고용 | 실제 과거 데이터 복사 | FRED UNRATE 등 |
| 뉴스 | LLM으로 가상 헤드라인 생성 | 일 3~5개 |

> 💡 Mock 데이터는 실제 API 응답 포맷과 동일하게 생성하여, 추후 실제 API 연동 시 코드 변경 최소화

#### 분석 기능 (FR-007 ~ FR-012)
- **트리거 방식**:
  - 고정일 알림: 설정된 N일 후 푸시 알림
  - 수동 요청: 사용자가 분석 버튼 클릭 시
- **분석 기간 설정**: 7일 / 14일 / 30일 / 90일 (사용자 선택)
- **복합 점수 산정**:
  - 수익률 점수: 예측 수익률 vs 실제 수익률 오차
  - 방향성 점수: 상승/하락 예측 일치율
  - 타이밍 점수: 매매 시점 적절성
  - 최종 점수: 가중 평균 (수익률 40%, 방향성 40%, 타이밍 20%)
- **자체 분석 옵션**: AI 분석 전 사용자 자체 평가 작성 기회
- **비교 분석**: AI 분석과 자체 분석 비교 시 정확도 추가 측정

#### 분석 결과 저장 (FR-013)
- 날짜별 분석 결과 저장
- 분석 히스토리 조회
- 분석 결과 내보내기 (선택)

### 2-2. Frontend 관점

#### 인증 화면
- 소셜 로그인 버튼 (Google, Kakao)
- 약관 동의 절차

#### 포트폴리오 화면
- 보유 자산 목록 (종목명, 수량, 평균가, 현재가, 수익률)
- 자산 추가/수정/삭제 모달
- 종목 검색 (자동완성)
- 총 자산 가치, 총 수익률 요약

#### 매매기록 화면
- 매매 히스토리 리스트
- 필터: 기간, 종목, 매수/매도
- 매매 상세 보기

#### 투자일기 화면
- 캘린더 뷰 (일기 작성일 표시)
- 일기 작성/편집 에디터
- 매매기록 자동 연동 표시
- 당일 시장 데이터 사이드바

#### 분석 화면
- 분석 요청 버튼
- 분석 기간 설정 드롭다운
- AI 분석 전 자체 분석 작성 모달 (선택)
- 분석 결과 대시보드:
  - 종합 점수 (게이지 차트)
  - 항목별 점수 (수익률, 방향성, 타이밍)
  - AI 피드백 텍스트
  - (선택) 자체 분석 vs AI 분석 비교

#### 분석 히스토리 화면
- 과거 분석 결과 리스트
- 날짜별 필터
- 분석 상세 보기

## 3. 관련 기존 모듈

| 유형 | 이름 | 영향 |
|------|------|------|
| 신규 프로젝트 | - | 기존 모듈 없음 |

## 4. 비기능 요구사항

| 항목 | 요구사항 |
|------|----------|
| 성능 | 페이지 로드 3초 이내, API 응답 1초 이내 |
| 보안 | OAuth 2.0, HTTPS 필수, 개인정보 암호화 저장 |
| 동시성 | 초기 1,000 DAU 기준 설계 |
| 가용성 | 99.5% 업타임 (SLA) |
| 확장성 | 마이크로서비스 전환 가능한 모듈 구조 |

## 4.5. 데이터 계약

### 입력 데이터
| 필드 | 타입 | 필수 | 검증 | 소스 |
|------|------|------|------|------|
| 종목코드 | string | Y | 유효 종목코드 | 사용자 입력 / 검색 API |
| 수량 | integer | Y | > 0 | 사용자 입력 |
| 매입가 | decimal | Y | > 0 | 사용자 입력 |
| 일기 본문 | text | Y | 1~10,000자 | 사용자 입력 |
| 분석 기간 | enum | Y | 7/14/30/90 | 사용자 선택 |

### 출력 데이터
| 필드 | 타입 | 설명 | 소비자 |
|------|------|------|--------|
| 포트폴리오 목록 | array | 보유 자산 리스트 | Frontend |
| 매매기록 | array | 매매 히스토리 | Frontend |
| 분석 결과 | object | 점수 + AI 피드백 | Frontend |
| 시장 데이터 | object | 주가/지수/뉴스/지표 | Frontend |

### 데이터 권한
| 데이터 | 읽기 | 쓰기 | 조건 |
|--------|------|------|------|
| 포트폴리오 | 본인만 | 본인만 | 로그인 필수 |
| 투자일기 | 본인만 | 본인만 | 로그인 필수 |
| 분석 결과 | 본인만 | 시스템 | 자동 생성 |
| 시장 데이터 | 전체 | 시스템 | 공개 데이터 |

## 4.6. 예외 및 에러 정책

### 예상 예외 시나리오
| 시나리오 | 처리 방법 | 사용자 메시지 |
|----------|----------|---------------|
| 유효하지 않은 종목코드 | 입력 거부 | "유효하지 않은 종목코드입니다" |
| 시장 데이터 API 실패 | 캐시 데이터 제공 | "최신 데이터를 가져올 수 없습니다 (캐시 표시)" |
| 분석 LLM 타임아웃 | 재시도 후 알림 | "분석 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요" |
| 소셜 로그인 실패 | 에러 표시 + 재시도 | "로그인에 실패했습니다. 다시 시도해주세요" |

### 에러 응답 형식
| HTTP Code | Error Code | 시나리오 |
|-----------|------------|----------|
| 400 | INVALID_INPUT | 입력값 검증 실패 |
| 401 | UNAUTHORIZED | 인증 필요/만료 |
| 403 | FORBIDDEN | 권한 없음 (타인 데이터 접근) |
| 404 | NOT_FOUND | 리소스 없음 |
| 500 | INTERNAL_ERROR | 서버 내부 오류 |
| 503 | SERVICE_UNAVAILABLE | 외부 API 장애 |

### 복구 전략
- **재시도 가능**: 시장 데이터 조회, 분석 요청
- **롤백 필요**: 포트폴리오 변경 실패 시 이전 상태 유지
- **알림 필요**: LLM API 장애 지속 시 운영자 알림

## 5. 미해결 사항

- [x] ~~시장 데이터 API 제공자 선정~~ → **MVP에서는 Mock 데이터 사용** (추후: 아래 표 참조)
  
  | 데이터 | 선정 API |
  |--------|----------|
  | 한국 주가/지수 | 공공데이터포털 + KOSCOM |
  | 미국 주가/지수/VIX | Yahoo Finance (yfinance) |
  | 경제지표 (미국) | FRED API |
  | 경제지표 (한국) | 한국은행 ECOS |
  | 원자재 | FRED API / OilPriceAPI |
  | 뉴스 | Finnhub (무료) / Financial News API |

- [ ] LLM 분석 모델 선정 (GPT-4? Claude?)
- [ ] 푸시 알림 인프라 선정 (FCM?)
- [ ] 증권사 API 연동 시 지원 증권사 범위 (추후)

## 6. 개발 우선순위

### MVP (Must Have)
1. 소셜 로그인 (Google, Kakao)
2. 포트폴리오 수동 관리 (CRUD)
3. 매매기록 자동 생성
4. 투자일기 작성
5. **시장 데이터 표시 (90일 Mock 데이터 기반)** ← PoC용
6. AI 분석 (수동 요청)
7. 분석 결과 저장/조회

### Should Have (Post-MVP)
1. **실제 시장 데이터 API 연동** (Mock → Real 전환)
2. 고정일 자동 분석 알림
3. 분석 기간 사용자 설정
4. 자체 분석 작성 및 비교
5. 복합 점수 상세 breakdown

### Nice to Have
1. 증권사 API 연동
2. 투자 스타일 분류 (MBTI식)
3. 수익률/승률 랭킹
4. 커뮤니티 기능
5. 뉴스 피드 기능
6. 투자 교육 콘텐츠
7. 가상 투자 시뮬레이션
8. 투자 목표 설정/추적
9. 투자 대회

## 7. 완료 기준

- [ ] 소셜 로그인으로 회원가입/로그인 가능
- [ ] 포트폴리오에 국내/미국 주식 등록 가능
- [ ] 포트폴리오 변경 시 매매기록 자동 생성
- [ ] 투자일기 작성 시 매매기록 연동 표시
- [ ] 투자일기 작성 시 당일 시장 데이터 표시
- [ ] 분석 요청 시 AI가 과거 판단 vs 실제 결과 비교 분석
- [ ] 분석 결과에 복합 점수 표시
- [ ] 과거 분석 결과 재조회 가능
