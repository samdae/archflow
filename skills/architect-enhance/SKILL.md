---
id: architect-enhance
name: Architect Enhance
description: |
  Design enhancement for existing features based on synced architect document.
  Analyzes existing architect.md and designs improvements.

  Triggers: architect-enhance, enhance design, improve architecture, Í∏∞Îä• Í∞úÏÑ†
user-invocable: true
version: 2.0.0
triggers:
  - "architect-enhance"
  - "architecture enhancement"
  - "feature enhancement"
requires: ["architect"]
platform: all
recommended_model: opus
agents:
  debate: archflow:domain-architect, archflow:best-practice-advisor
allowed-tools:
  - Read
  - Write
  - Glob
  - Grep
  - LS
  - Task
  - AskQuestion
---

> **Language**: This skill is written in English for universal compatibility.
> Always respond in the user's language unless explicitly requested otherwise.
> If uncertain about the user's language, ask for clarification.

# Architect Enhance Workflow

Add enhancement requirements to existing architect document and update the design accordingly.

## üí° Recommended Model

**Opus Required** - Consistency analysis with existing design is critical

‚Üí Existing architect + new requirements + conflict validation = complex analysis

## üîÑ Tool Fallback

| Tool | Alternative when unavailable |
|------|------------------------------|
| **Read/Grep** | Request file path from user ‚Üí ask for copy-paste |
| **AskQuestion** | "Please select: 1) OptionA 2) OptionB 3) OptionC" format |
| **Task** | Use step-by-step analysis without sub-agents, request user confirmation at each step |

## üìÅ Document Structure

```
projectRoot/
  ‚îî‚îÄ‚îÄ docs/
        ‚îî‚îÄ‚îÄ {serviceName}/
              ‚îú‚îÄ‚îÄ requirements.md        # Original requirements
              ‚îú‚îÄ‚îÄ requirements-v2.md     # ‚Üê Enhancement requirements (require-refine output)
              ‚îú‚îÄ‚îÄ architect.md           # ‚Üê Existing design (synced state recommended)
              ‚îî‚îÄ‚îÄ changelog.md
```

## ‚ö†Ô∏è Prerequisites

1. **Existing architect.md** is up-to-date (architect-sync completed after bugfix)
2. **Enhancement requirements** refined through require-refine

---

## Phase 0: Skill Entry

### 0-0. Model Guidance

> ‚ö†Ô∏è **This skill strongly recommends using the Opus model.**
> Consistency analysis with existing design is critical, requiring a high-performance model.
>
> **Input**:
> - Enhancement requirements (requirements-v2.md or similar)
> - Existing architect.md (synced state recommended)
>
> **Output**: Updated architect.md

### 0-1. Collect Input Information

```json
{
  "title": "Feature Enhancement Design",
  "questions": [
    {
      "id": "has_enhance_req",
      "prompt": "Do you have an enhancement requirements document? (generated by require-refine)",
      "options": [
        {"id": "yes", "label": "Yes - I will provide via @filepath"},
        {"id": "no", "label": "No - Need requirements refinement first"}
      ]
    }
  ]
}
```

- `no` ‚Üí Guide to **require-refine** skill
- `yes` ‚Üí Request file path

```json
{
  "title": "Existing Design Document",
  "questions": [
    {
      "id": "has_architect",
      "prompt": "Do you have an existing architect.md?",
      "options": [
        {"id": "yes", "label": "Yes - I will provide via @filepath"},
        {"id": "no", "label": "No - This is a new feature"}
      ]
    },
    {
      "id": "is_synced",
      "prompt": "Is architect.md up-to-date (bugfixes reflected)?",
      "options": [
        {"id": "yes", "label": "Yes - It's up-to-date"},
        {"id": "no", "label": "No - Sync required"},
        {"id": "unsure", "label": "Not sure"}
      ]
    }
  ]
}
```

- `is_synced: no` ‚Üí Recommend running **architect-sync** first
- `has_architect: no` ‚Üí Guide to regular **architect** skill (new feature)

### 0-2. Infer serviceName

Extract serviceName from input file path:
- Input: `docs/alert/architect.md`
- Extract: `serviceName = "alert"`

### 0-3. Git Commit Strategy

```json
{
  "title": "Git Commit Before Modification",
  "questions": [
    {
      "id": "git_strategy",
      "prompt": "Would you like to commit the current architect.md before modification?",
      "options": [
        {"id": "commit", "label": "Yes - Commit then proceed (recommended)"},
        {"id": "skip", "label": "No - Proceed directly"}
      ]
    }
  ]
}
```

- `commit` selected:
  ```bash
  git add docs/{serviceName}/architect.md
  git commit -m "backup: architect.md before enhance"
  ```
- `skip` selected: Proceed directly to Phase 1

---

## Phase 1: Document Analysis

### 1-1. Analyze Existing Architect

Extract core information from existing design:

| Section | Information to Extract |
|---------|----------------------|
| Summary | Current Goal, Non-goals |
| Scope | Current implementation scope |
| Architecture | Component structure, DB schema |
| Code Mapping | Current file/class/method structure |
| API Spec | Current API list |

### 1-2. Analyze Enhancement Requirements

Extract from enhancement requirements:

| Item | Content |
|------|---------|
| New features | Features to implement |
| Modified features | Existing feature modifications |
| Removed features | Features no longer needed |
| Non-functional requirements | Performance/security improvements |

### 1-3. Impact Analysis

```markdown
## Impact Analysis

### Additions Required
| Item | Content | Affected Sections |
|------|---------|------------------|
| New API | {endpoint} | API Spec, Code Mapping |
| New table | {table name} | DB Schema, Architecture |

### Modifications Required
| Item | Current | After | Affected Sections |
|------|---------|-------|------------------|
| API change | {current spec} | {new spec} | API Spec |
| Schema change | {current columns} | {new columns} | DB Schema |

### Deletions
| Item | Reason |
|------|--------|
| {item to delete} | {reason} |
```

---

## Phase 2: Enhancement Design (Sub-agent Collaboration)

### 2-A: Invoke Domain Architect

**Use Task tool** to call `domain-architect` sub-agent:

```
Task(
  subagent_type: "domain-architect",
  description: "Enhancement design based on existing design",
  prompt: """
    Existing architect.md: {existing design content}
    Enhancement requirements: {enhancement requirements}

    Provide enhancement design that maintains consistency with existing design.
    - Maintain existing patterns/structure
    - Minimize changes
    - Consider migration
  """
)
```

### 2-B: Invoke Best Practice Advisor

**Use Task tool** to call `best-practice-advisor` sub-agent:

```
Task(
  subagent_type: "best-practice-advisor",
  description: "Enhancement best practices",
  prompt: """
    Enhancement requirements: {enhancement requirements}

    Provide ideal design for this enhancement.
    (No knowledge of existing design - no context)
  """
)
```

### 2-C: Collaboration (Same as architect skill)

Round 1-2 collaboration ‚Üí User checkpoint ‚Üí Decision

---

## Phase 3: Integration with Existing Architect

### 3-1. Integration Strategy

| Change Type | Integration Method |
|------------|-------------------|
| Addition | Add new items to relevant sections |
| Modification | Replace existing items with new content |
| Deletion | Apply ~~strikethrough~~ to existing items or remove |

### 3-2. Section-by-Section Integration

**Summary Section:**
- Modify/expand Goal
- Update Non-goals

**Scope Section:**
- Add In scope items
- Review Out of scope

**Architecture Impact Section:**
- Add/modify Components
- Add/modify DB Schema

**Code Mapping Section:**
- Add new file/class/method
- Mark modifications to existing items

**API Spec Section:**
- Add new endpoints
- Modify existing endpoints

**Implementation Plan Section:**
- Add enhancement implementation steps

### 3-3. Enhancement Marking

Mark integrated content as enhancement:

```markdown
## 6. API Specification

### Existing APIs
(Keep existing content)

### üÜï Enhanced APIs (v2 - {date})
| Endpoint | Method | Description |
|----------|--------|-------------|
| /api/v1/alerts/batch | POST | Batch alert processing (enhancement) |
```

---

## Phase 4: Quality Gate Validation

Perform same quality validation as Phase 5.5 in architect skill:

### Required Validation Items

| Item | Validation Criteria |
|------|-------------------|
| Existing feature impact | Check existing API/schema compatibility |
| New feature completeness | Verify all enhancement requirements reflected |
| Migration | Verify migration plan for DB changes |

---

## Phase 5: Save and Complete

### 5-1. Update architect.md

Save existing architect.md with integrated enhancement content.

### 5-2. Add Sync History

```markdown
---

## Sync History

| Date | Type | Source | Changes |
|------|------|--------|---------|
| {date} | enhance | requirements-v2 | {enhancement summary} |
```

### 5-3. Completion Report

```markdown
## Enhancement Design Complete

### Summary
| Item | Content |
|------|---------|
| Service | {serviceName} |
| Enhancement Requirements | {requirements file} |
| Modified Sections | {section list} |

### Key Changes
- **Added**: {added features/APIs/tables}
- **Modified**: {modified items}
- **Removed**: {removed items}

### Files
- Updated: `docs/{serviceName}/architect.md`

### Next Steps
1. Review architect.md
2. Start implementation with `implement` skill
```

---

# Integration Flow

```
[require-refine] ‚Üí existing requirements.md

(Enhancement needed)
        ‚Üì
[require-refine] ‚Üí requirements-v2.md (enhancement requirements)
        ‚Üì
[architect-enhance] ‚Üê synced architect.md
        ‚Üì
Updated architect.md
        ‚Üì
[implement] ‚Üí Enhancement implementation
```

---

# Important Notes

1. **Run architect-sync first (recommended)**
   - Existing architect must be up-to-date for accurate analysis

2. **Existing feature compatibility**
   - Must verify enhancement doesn't break existing features
   - Explicitly warn on breaking changes

3. **Incremental enhancement**
   - Avoid too many changes at once
   - Recommend step-by-step enhancement

4. **Consider migration**
   - Migration plan required for DB schema changes
   - Validate data compatibility
